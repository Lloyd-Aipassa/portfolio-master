---
export const prerender = false;

import Layout from "../layouts/Layout.astro";
import Background from '../components/Background.astro';

const { id } = Astro.params;
let data = null;
let error = null;

try {
	const response = await fetch(
		`https://api.coingecko.com/api/v3/coins/${id}`,
		{
			method: "GET",
			headers: {
				"Content-Type": "application/json",
			},
		}
	);

	if (!response.ok) {
		throw new Error(`HTTP error! Status: ${response.status}`);
	}

	data = await response.json();
} catch (err) {
	console.error("Error fetching coin data:", err);
	error = err.message;
}
---

<Layout title="single">
	<Background />
	<main>
		{error ? (
			<div class="error-container">
				<h1>Error Loading Coin</h1>
				<p>{error}</p>
				<button class="back-button" onclick="window.history.back()">Back</button>
			</div>
		) : (
		<div class="coin-detail-card">
			<h1>{data?.name || 'Loading...'}</h1>
			<img
				class="coin-image"
				src={data.image.large}
				alt={data.name}
				
			/>
			<div class="coin-stats">
				<div class="stat-item">
					<p class="stat-label">All Time High</p>
					<p class="stat-value">
						€{
							data.market_data.ath.eur.toLocaleString()
						}
					</p>
				</div>
				<div class="stat-item">
					<p class="stat-label">ATH Date</p>
					<p class="stat-value">
						{
							new Date(
								data.market_data.ath_date.eur
							).toLocaleDateString()
						}
					</p>
				</div>
				<div class="stat-item">
					<p class="stat-label">Current Price</p>
					<p class="stat-value">
						€{
							data.market_data.current_price.eur.toLocaleString()
						}
					</p>
				</div>
				<div class="stat-item">
					<p class="stat-label">
						24h Price Change
					</p>
					<p
						class={`stat-value ${data.market_data.price_change_percentage_24h_in_currency.eur > 0 ? "positive" : "negative"}`}
					>
						{
							data.market_data.price_change_percentage_24h_in_currency.eur.toFixed(
								2
							)
						}%
					</p>
				</div>
				<div class="stat-item">
					<p class="stat-label">
						Market Cap Rank
					</p>
					<p class="stat-value">
						#{
							data.market_data
								.market_cap_rank
						}
					</p>
				</div>
				<!-- <div class="stat-item">
					<p class="stat-label">
						24h Price Change
					</p>
					<p
						class={`stat-value ${data.market_data.price_change_24h_in_currency.eur > 0 ? "positive" : "negative"}`}
					>
						€{
							data.market_data.price_change_24h_in_currency.eur.toLocaleString()
						}
					</p>
				</div> -->
				<div class="stat-item">
					<p class="stat-label">Total Supply</p>
					<p class="stat-value">
						{
							data.market_data
								.total_supply
								? data.market_data.total_supply.toLocaleString()
								: "N/A"
						}
					</p>
				</div>
			</div>
			<button
				class="back-button"
				onclick="window.history.back()">Back</button
			>
		</div>
		)}
	</main>
</Layout>
<script>
	async function CoinData() {
		try {
			const response = await fetch(
				"https://api.coingecko.com/api/v3/coins/minswap",
				{
					method: "GET",
					headers: {
						"Content-Type":
							"application/json",
					},
				}
			);

			if (!response.ok) {
				throw new Error(
					`HTTP error! Status: ${response.status}`
				);
			}

			const data = await response.json();

			// Log de data om te zien wat je krijgt
			console.log(data); // <-- Dit helpt om te controleren wat je krijgt

			return data;
		} catch (error) {
			console.error(
				"Er is een fout opgetreden tijdens het ophalen van de gegevens:",
				error
			);
		}
	}

	CoinData();
</script>

<style>
	/* main {
		margin: auto;
		padding: 1rem;
		width: 1200px;
		max-width: calc(100% - 2rem);

		font-size: 20px;
		line-height: 1.6;
	} */

	.error-container {
		background: rgba(255, 77, 77, 0.1);
		border: 1px solid rgba(255, 77, 77, 0.3);
		border-radius: 20px;
		padding: 30px;
		text-align: center;
		color: #ff4d4d;
		max-width: 700px;
		margin: 0 auto;
	}

	.error-container h1 {
		color: #ff4d4d;
		margin-bottom: 15px;
	}

	.error-container p {
		margin-bottom: 20px;
		color: rgba(255, 77, 77, 0.8);
	}

	h1 {
		font-size: 4rem;
		font-weight: 700;
		line-height: 1;
		text-align: center;
		margin-bottom: 1rem;
	}

	h2 {
		font-size: 3rem;
		font-weight: 700;
		line-height: 1;
		text-align: center;
		margin-bottom: 1rem;
	}

	main {
		color: white;
		max-width: 700px;
		margin: 0 auto;
		padding: 20px;
	}

	.coin-detail-card {
		background: rgba(255, 255, 255, 0.05);
		backdrop-filter: blur(10px);
		-webkit-backdrop-filter: blur(10px);
		border-radius: 20px;
		border: 1px solid rgba(255, 255, 255, 0.1);
		padding: 30px;
		box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
		display: flex;
		flex-direction: column;
		align-items: center;
		text-align: center;
	}

	h1 {
		font-size: 2.5rem;
		margin-bottom: 20px;
		color: #3498db;
	}

	.coin-image {
		width: 100px;
		height: 100px;
		border-radius: 75px;
		margin-bottom: 20px;
		box-shadow: 0 0 20px rgba(52, 152, 219, 0.5);
	}

	.coin-stats {
		display: flex;
		flex-wrap: wrap;
		max-width: 700px;
		gap: 15px;
		margin-bottom: 30px;
		justify-content: center;
	}

	.stat-item {
		background: rgba(255, 255, 255, 0.1);
		border-radius: 10px;
		padding: 15px;
		transition: transform 0.3s ease;
		width: calc(33.3% - 30px);
		aspect-ratio : 1 / 1;
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
	}

	.stat-item:hover {
		transform: translateY(-5px);
	}

	.stat-label {
		font-size: 0.9rem;
		color: rgba(255, 255, 255, 0.7);
		margin-bottom: 5px;
	}

	.stat-value {
		font-size: 1.1rem;
		font-weight: bold;
	}

	.positive {
		color: #4caf50;
	}

	.negative {
		color: #ff4d4d;
	}

	.back-button {
		background-color: #3498db;
		color: white;
		border: none;
		padding: 10px 20px;
		border-radius: 5px;
		font-size: 1rem;
		font-weight: bold;
		cursor: pointer;
		transition: all 0.3s ease;
	}

	.back-button:hover {
		background-color: #2980b9;
		transform: translateY(-2px);
	}

	.back-button:active {
		transform: translateY(0);
	}

	@media (max-width: 600px) 
	{

		main {
		max-width: 800px;
		width: ;
		margin: 0 auto;
		padding: 20px;
	}

	.coin-stats {
		display: flex;	
		flex-wrap: wrap;
		max-width: 500px;
		gap: 15px;
		margin-bottom: 30px;
	}

	.stat-item {
		width: calc(50% - 15px);
	}


		h1 {
			font-size: 2rem;
		}

		.coin-image {
			width: 60px;
			height: 60px;
		}
	}
</style>